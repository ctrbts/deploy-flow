# Documentación de Despliegue: Ubuntu Cloud-Init + Docker

## Fase 1: Creación de la Plantilla (Proxmox)

El objetivo es crear una "Golden Image" inmutable que permita desplegar VMs pre-configuradas en segundos. Realizaremos esto desde la shell del nodo Proxmox (p. ej: `pve`).

Creamos el archivo `setup-cloud-init.sh`:

```bash
nano setup-cloud-init.sh
```

Pegamos el contenido del archivo `setup-cloud-init.sh` en la shell del nodo Proxmox, lo guardamos (Ctrl+O, Ctrl+X) y ejecutamos:

```bash
chmod +x setup-cloud-init.sh
./setup-cloud-init.sh
```

---

## Fase 2: Instanciación y Configuración Inicial

### 2.1. Clonado

Desde la interfaz web de Proxmox:

1. Click derecho en la template `9000` -> **Clone**.
2. Mode: **Full Clone** (Recomendado para producción) o **Linked Clone** (Rápido para labs).
3. Asignar ID y Nombre (ej: `docker-host-01`).

### 2.2. Inyección de Configuración (Cloud-Init)

**IMPORTANTE:** Antes de iniciar la VM por primera vez, ir a la pestaña **Cloud-Init** de la nueva VM y configurar:

* **User:** `soporte` (o tu usuario preferido).
* **Password:** Definir una contraseña segura.
* **SSH Public Key:** Pegar tu clave pública (`cat ~/.ssh/id_ed25519.pub`).
* **IP Config:** `DHCP` o `Static` (ej: `192.168.1.50/24`, Gateway `192.168.1.1`).
* **Acción Final:** Click en el botón **Regenerate Image**.

### 2.3. Primer Boot y Acceso

Iniciar la VM. Esperar unos segundos a que Cloud-Init aplique los cambios.
Acceder desde tu terminal local:

```bash
ssh soporte@<IP-DE-LA-VM>

```

---

## Fase 3: Aprovisionamiento de Docker y Dockge

Desde la consola de la VM, crear el script de aprovisionamiento:

```bash
sudo nano setup-docker.sh
```

Pegar el contenido del archivo `setup-docker.sh`. Guardar (Ctrl+O, Ctrl+X) y ejecutar:

```bash
sudo chmod +x setup-docker.sh
sudo ./setup-docker.sh
```
